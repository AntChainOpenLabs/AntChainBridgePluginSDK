<div align="center">
  <img alt="am logo" src="https://antchainbridge.oss-cn-shanghai.aliyuncs.com/antchainbridge/document/picture/antchain.png" width="250" >
  <h1 align="center">AntChain Bridge Committee PTC</h1>
  <p align="center">
    <a href="http://makeapullrequest.com">
      <img alt="pull requests welcome badge" src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat">
    </a>
    <a href="https://www.java.com">
      <img alt="Language" src="https://img.shields.io/badge/Language-Java-blue.svg?style=flat">
    </a>
    <a href="https://github.com/AntChainOpenLab/AntChainBridgeRelayer/graphs/contributors">
      <img alt="GitHub contributors" src="https://img.shields.io/github/contributors/AntChainOpenLab/AntChainBridgeCommitteePtc">
    </a>
    <a href="https://www.apache.org/licenses/LICENSE-2.0">
      <img alt="License" src="https://img.shields.io/github/license/AntChainOpenLab/AntChainBridgeCommitteePtc?style=flat">
    </a>
  </p>
</div>

## ğŸ’¡ä»‹ç»

åœ¨AntChain Bridgeçš„è®¾è®¡ä¸­ï¼Œè¯æ˜è½¬åŒ–ç»„ä»¶ï¼ˆ*Proof Transform Component, PTC*ï¼‰è´Ÿè´£æä¾›å¯ä¿¡çš„è·¨é“¾æ•°æ®éªŒè¯å’ŒèƒŒä¹¦åŠŸèƒ½ï¼ŒPTCä½œä¸ºä¸€ç§è§’è‰²å’ŒæŠ½è±¡ï¼Œç›®å‰æœ‰å¤šç§å®ç°ç±»å‹ï¼Œå§”å‘˜ä¼šPTCï¼ˆ*Committee PTC*ï¼‰å°±æ˜¯å…¶ä¸­ä¸€ç§å®ç°ã€‚

é¡¾åæ€ä¹‰ï¼Œåœ¨è·¨é“¾ä¸­Committee PTCå°±æ˜¯é€šè¿‡å§”å‘˜ä¼šçš„å½¢å¼ï¼Œæ¯ä¸ªæˆå‘˜å¤‡æœ‰è‡ªå·±çš„ç§é’¥ï¼Œå¯¹è·¨é“¾æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œç„¶åä½¿ç”¨ç§é’¥å¯¹è·¨é“¾æ•°æ®è¿›è¡Œç­¾åï¼Œç„¶åè¿”å›å…¶èƒŒä¹¦ç»“æœï¼Œå®¢æˆ·ç«¯éœ€è¦æ”¶é›†è¿™äº›ç­¾åï¼Œæœ€ç»ˆä½œä¸ºè·¨é“¾æ•°æ®çš„ç¬¬ä¸‰æ–¹è¯æ˜ï¼ˆ*Third Party Proof, TpProof*ï¼‰ï¼Œç”¨äºåç»­åœ¨æ¥æ”¶é“¾æäº¤è·¨é“¾æ¶ˆæ¯æ—¶è¿›è¡ŒéªŒè¯ã€‚

Committee PTCçš„å…±åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

- nodeï¼šæ‰§è¡ŒéªŒè¯å’ŒèƒŒä¹¦çš„èŠ‚ç‚¹ï¼Œä½œä¸ºæœåŠ¡ç«¯å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé€šè¿‡åŠ è½½å¼‚æ„é“¾æ•°æ®éªŒè¯æœåŠ¡ï¼ˆ*Hetero-Chain Data Verification Service, HCDVS*ï¼‰æ¥å®Œæˆå¯¹ä¸åŒå¼‚æ„é“¾æ•°æ®çš„éªŒè¯è¿‡ç¨‹ï¼Œæ¯”å¦‚éªŒè¯å…±è¯†çŠ¶æ€ï¼ˆä¸€èˆ¬æ˜¯å¯¹åŒºå—å¤´çš„æŠ½è±¡ï¼‰ã€è·¨é“¾æ¶ˆæ¯è¯æ˜ï¼ˆå¾€å¾€æ˜¯å¸æœ¬æ•°æ®çš„Merkle Proofï¼‰ç­‰çš„éªŒè¯ï¼ŒéªŒè¯ä¹‹åï¼Œcommittee nodeä¼šå¯¹æ•°æ®è¿›è¡Œæ•°å­—ç­¾åå¹¶è¿”å›ï¼Œcommittee nodeçš„æœåŠ¡åœ°å€å°†è¢«å…¬å¼€åœ¨BCDNSä¸­ã€‚
- supervisorï¼šç”¨äºç®¡ç†Committeeä½œä¸ºPTCçš„èº«ä»½ä¿¡æ¯ï¼ŒæŒæœ‰PTCè·¨é“¾è¯ä¹¦å¯¹åº”çš„ç§é’¥ï¼Œè´Ÿè´£æ›´æ–°BCDNSä¸Šçš„PTCä¿¡ä»»æ ¹ï¼ŒåŒ…å«committee nodesçš„å…¬é’¥å’Œç½‘ç»œä¿¡æ¯ï¼Œä¾¿äºAntChain Bridgeä¸­çš„å…¶ä»–å‚ä¸è€…å¯ä»¥è½»æ¾è·å–å¹¶éªŒè¯Committeeå‡ºå…·çš„è¯æ˜ã€‚

## ğŸ”œå¿«é€Ÿå¼€å§‹

### ç¯å¢ƒ

Committee Nodeä½¿ç”¨äº†MySQLï¼Œè¿™é‡Œå»ºè®®ä½¿ç”¨dockerå¿«é€Ÿå®‰è£…ä¾èµ–ã€‚

é¦–å…ˆé€šè¿‡è„šæœ¬å®‰è£…dockerï¼Œæˆ–è€…åœ¨[å®˜ç½‘](https://docs.docker.com/get-docker/)ä¸‹è½½ã€‚

```
wget -qO- https://get.docker.com/ | bash
```

ç„¶åä¸‹è½½MySQLé•œåƒå¹¶å¯åŠ¨å®¹å™¨ï¼Œæ³¨æ„è¿™é‡ŒæŒ‡å®šäº†æ—¶åŒºä¸º`+08:00`ï¼Œè¯·ä¿®æ”¹ä¸ºæ‚¨çš„æ—¶åŒºã€‚

```
docker run -itd --name mysql-test -p 3306:3306 -e MYSQL_ROOT_PASSWORD='YOUR_PWD' mysql:8 --mysql-native-password=ON --default_time_zone +08:00
```

### ç¼–è¯‘

- Committee PTCè¦æ±‚Java21ï¼Œè¯·æå‰[ä¸‹è½½](https://adoptium.net/temurin/releases/)å¹¶å®‰è£…ï¼›
- ä¸‹è½½å¹¶å®‰è£…mavenï¼›
- æå‰å®‰è£…[AntChain Bridge SDK](https://github.com/AntChainOpenLabs/AntChainBridgePluginSDK)ï¼Œå½“å‰Committee ä½¿ç”¨äº†`1.0.0-SNAPSHOT`ç‰ˆæœ¬ï¼›

è¿è¡Œä¸‹é¢å‘½ä»¤ä»¥ç¼–è¯‘ï¼š

```
mvn clean package -DskipTests 
```

Committee Nodeçš„åˆ¶å“åœ¨`node/target/committee-node-0.1.0-SNAPSHOT.tar.gz`å¯ä»¥æ‰¾åˆ°ï¼ŒSupervisorçš„åˆ¶å“å¯ä»¥åœ¨`supervisor/target/supervisor-cli-bin.tar.gz`æ‰¾åˆ°ã€‚

### å®‰è£…

å°†Committee Nodeå‹ç¼©åŒ…æ‹·è´åˆ°å®‰è£…ç›®å½•ï¼Œè§£å‹ä¹‹åå¯è§æ–‡ä»¶å¤¹`committee-node`ï¼Œç›®å½•binä¸‹é¢æ˜¯ä¸€äº›è„šæœ¬ï¼Œlibä¸‹æ˜¯ç¨‹åºjaråŒ…ï¼Œconfigä¸‹æ”¾ç½®äº†é…ç½®æ–‡ä»¶ï¼Œnode-cli-bin.tar.gzåŒ…å«äº†ä¸€ä¸ªCLIå·¥å…·ï¼Œç”¨äºé…ç½®æœåŠ¡ï¼š

```
â•°â”€Â± tree . -L 2
.
â”œâ”€â”€ README.md
â”œâ”€â”€ bin
â”‚Â Â  â”œâ”€â”€ committee-node.service
â”‚Â Â  â”œâ”€â”€ init_tls_certs.sh
â”‚Â Â  â”œâ”€â”€ print.sh
â”‚Â Â  â”œâ”€â”€ start.sh
â”‚Â Â  â””â”€â”€ stop.sh
â”œâ”€â”€ config
â”‚Â Â  â””â”€â”€ application.yml
â”‚Â Â  â””â”€â”€ ddl.sql
â”œâ”€â”€ lib
â”‚Â Â  â””â”€â”€ committee-node-0.1.0-SNAPSHOT.jar
â””â”€â”€ node-cli-bin.tar.gz

3 directories, 9 files
```

ç±»ä¼¼çš„ï¼Œå°†Supervisorçš„å‹ç¼©åŒ…è§£å‹åˆ°å®‰è£…ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°`supervisor-cli`ï¼Œç›®å½•ç»“æ„å’ŒCommittee Nodeç±»ä¼¼ã€‚

```
â•°â”€Â± tree . -L 2
.
â”œâ”€â”€ README.md
â”œâ”€â”€ bin
â”‚Â Â  â””â”€â”€ start.sh
â”œâ”€â”€ conf
â”‚Â Â  â””â”€â”€ config.json
â””â”€â”€ lib
    â””â”€â”€ supervisor-cli.jar

3 directories, 4 files
```

### å¯åŠ¨æœåŠ¡

> [!IMPORTANT]  
> è¯·ç¡®ä¿ä½ çš„æ‰§è¡Œç¯å¢ƒé»˜è®¤ä½¿ç”¨JDK21ï¼Œå¯ç”¨java -versionæ£€æŸ¥ğŸ§

**ç¬¬ä¸€æ­¥**è¿è¡Œè„šæœ¬`bin/init_tls_certs.sh`ï¼Œä¼šåœ¨`tls_certs`ç›®å½•ä¸‹ç”ŸæˆTLSè¯ä¹¦ï¼š

```
â•°â”€Â± tree tls_certs 
tls_certs
â”œâ”€â”€ server.crt
â”œâ”€â”€ server.key
â””â”€â”€ trust.crt
```

ç„¶åè§£å‹node-cli-bin.tar.gzï¼Œè¿è¡Œï¼š

```
# cd node-cli && bin/start.sh
  _   _   ___   ____   _____
 | \ | | / _ \ |  _ \ | ____|
 |  \| || | | || | | ||  _|
 | |\  || |_| || |_| || |___
 |_| \_| \___/ |____/ |_____|

        CLI 0.1.0-SNAPSHOT

node:>
```



**ç¬¬äºŒæ­¥**ï¼Œè¾“å…¥å‘½ä»¤ç”ŸæˆNodeçš„å¯†é’¥ï¼Œ`--outDir`åˆ¶å®šå¯†é’¥å­˜å‚¨è·¯å¾„ï¼Œç”Ÿæˆä¹‹åï¼Œå¯ä»¥åœ¨è¯¥è·¯å¾„çœ‹åˆ°ï¼Œ` private_key.pemã€public_key.pem`ä¸¤ä¸ªæ–‡ä»¶ï¼š

```
generate-node-account --outDir /path/to/committee-node1/committee-node/
```



**ç¬¬ä¸‰æ­¥**ï¼Œåœ¨Supervisor è§£å‹çš„ç›®å½•`supervisor-cli`ä¸‹é¢ï¼Œè¿è¡Œbin/start.shï¼Œå¯åŠ¨Supervisor CLIï¼š

```
bin/start.sh
   _____ __  ______  __________ _    ___________ ____  ____
  / ___// / / / __ \/ ____/ __ \ |  / /  _/ ___// __ \/ __ \
  \__ \/ / / / /_/ / __/ / /_/ / | / // / \__ \/ / / / /_/ /
 ___/ / /_/ / ____/ /___/ _, _/| |/ // / ___/ / /_/ / _, _/
/____/\____/_/   /_____/_/ |_| |___/___//____/\____/_/ |_|


                             CLI 0.1.0-SNAPSHOT

supervisor:>
```

é¦–å…ˆä¸ºPTCè¯ä¹¦ç”Ÿæˆç§é’¥ã€å…¬é’¥ï¼ŒcommitteeIdæ˜¯å½“å‰è¿™ä¸ªå§”å‘˜ä¼šçš„å”¯ä¸€IDï¼ŒoutDiræŒ‡å®šäº†ç§é’¥å…¬é’¥å­˜å‚¨çš„è·¯å¾„ï¼š

```
generate-ptc-account --committeeId default --outDir /path/to/supervisor-cli/
```

ç„¶åï¼Œè¿è¡Œä¸‹é¢å‘½ä»¤ï¼Œç”Ÿæˆè¯ä¹¦ç­¾ç½²ï¼ˆCSRï¼‰è¯·æ±‚çš„Base64å†…å®¹ï¼š

```
generate-ptc-csr  --pubkeyFile /path/to/supervisor-cli/public_key.pem
your CSR is
AADGAAAAAAABAAAAMQIAAQAAAAIEAAgAAAAAAAAAAAAAAAUACAAAAAAAAAAAAAAABgCWAAAAAACQAAAAAAABAAAAMQEABQAAAG15cHRjAgABAAAAAQMAawAAAAAAZQAAAAAAAQAAAAABAFgAAAAwVjAQBgcqhkjOPQIBBgUrgQQACgNCAATZOh906PXjpuaffXOFQ//9wn5Y5WPDz738pPzFy/pOk/KuEt/gw5VeupcZS2NPrBBzSKm1DUyDR9ZvJthwJbNnBAAAAAAA
```

é€šè¿‡BCDNSç”³è¯·PTCè¯ä¹¦ï¼Œè¿™é‡Œéœ€è¦æ˜Ÿç«é“¾BCDNSçº¿ä¸‹ç­¾ç½²PTCè¯ä¹¦ï¼Œè¯·å°†ä¸Šé¢ğŸ‘†çš„Base64å‘é€ç»™BIF BCDNSè¿ç»´äººå‘˜ï¼Œè¯¦æƒ…è¯·è·³è½¬BIF BCDNS[æ–‡æ¡£](https://github.com/caict-4iot-dev/BCDNS?tab=readme-ov-file#%E7%A4%BA%E4%BE%8B)ğŸ“„ã€‚å¦‚æœBCDNSè¿”å›çš„æ˜¯Base64æ ¼å¼çš„è¯ä¹¦ï¼Œå¯ä»¥ä½¿ç”¨CLIå·¥å…·è½¬æ¢æˆPEMæ ¼å¼ã€‚

```
supervisor:> convert-cross-chain-cert-to-pem --base64Input AAAIAgAAAAABAAAAMQEAK...wWf/zi60DKnQ7xaCA==
-----BEGIN RELAYER CERTIFICATE-----
AAAIAgAAAAABAAAAMQEAKAAAAGRpZDpiaWQ6ZWY5OVJ6OFRpN3g0aTZ6eUNyUHlG
aXk5dXRzV0JKVVcCAAEAAAADAwA7AAAAAAA1AAAAAAABAAAAAQEAKAAAAGRpZDpi
...
4QlxLUp70uRK43ECAAcAAABFZDI1NTE5AwBAAAAAbA8zkKXCI4Iwp6KBERXOqKln
JT/qn36in7+iU6SsNEz0rsJpmEvVRT6adNVY7zS/ni35JwWf/zi60DKnQ7xaCA==
-----END RELAYER CERTIFICATE-----
```

æŠŠä¸Šé¢çš„PEMæ ¼å¼PTCè·¨é“¾è¯ä¹¦ä¿å­˜åˆ°æ–‡ä»¶ï¼Œæ‰“å¼€Supervisor CLIé…ç½®æ–‡ä»¶./conf/config.jsonï¼Œæ‰¾åˆ°ptc_certificateå­—æ®µï¼ŒæŠŠPTCè¯ä¹¦æ–‡ä»¶çš„è·¯å¾„å¡«åˆ°è¿™ä¸ªå­—æ®µï¼Œè¦æ±‚é‡å¯Supervisor CLIã€‚

**ç¬¬å››æ­¥**ï¼Œå‡†å¤‡BIF BCDNSçš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ã€‚

Supervisoréœ€è¦è®¿é—®BIF BCDNSï¼Œå› æ­¤è¦æ³¨å†ŒBCDNSæœåŠ¡ã€‚ç›®å‰æ”¯æŒæ˜Ÿç«é“¾ç½‘çš„BCDNSæœåŠ¡å®¢æˆ·ç«¯ï¼Œè¿™é‡Œä»‹ç»å…¶é…ç½®é¡¹å’Œå¦‚ä½•å®ä¾‹åŒ–è¯¥å®¢æˆ·ç«¯ã€‚é¦–å…ˆä»‹ç»é…ç½®ï¼Œä»£ç å¯[è§](file:///Users/zouxyan/IdeaProjects/odats-plugins/antchain-bridge-bcdns/src/main/java/com/alipay/antchain/bridge/bcdns/impl/bif/conf/BifBCNDSConfig.java)ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†`certificationServiceConfig`æ˜¯ç”¨äºå’Œé¢è¯æœåŠ¡é€šä¿¡ã€é‰´æƒï¼Œå¦ä¸€éƒ¨åˆ†`chainConfig`ç”¨äºå’Œæ˜Ÿç«é“¾ç½‘äº¤äº’ã€‚

```json
{
    "certificationServiceConfig": {
      "authorizedKeyPem": "-----BEGIN EC PRIVATE KEY-----\nMHQCAQE...==\n-----END EC PRIVATE KEY-----",
      "authorizedPublicKeyPem": "-----BEGIN PUBLIC KEY-----\nMFYwEAYH...WzZw==\n-----END PUBLIC KEY-----",
      "authorizedSigAlgo": "Keccak256WithSecp256k1",
      "clientCrossChainCertPem": "-----BEGIN PROOF TRANSFORMATION COMPONENT CERTIFICATE-----\nAADD...HbAQ==\n-----END PROOF TRANSFORMATION COMPONENT CERTIFICATE-----",
      "clientPrivateKeyPem": "-----BEGIN EC PRIVATE KEY-----\nMHQCAQE...==\n-----END EC PRIVATE KEY-----",
      "sigAlgo": "Keccak256WithSecp256k1",
      "url": "http://ip:8112"
    },
    "chainConfig": {
      "bifAddress": "",
      "bifChainRpcUrl": "http://test.bifcore.bitfactory.cn",
      "bifPrivateKey": "",
      "certificatesGovernContract": "",
      "domainGovernContract": "",
      "ptcGovernContract": "",
      "relayerGovernContract": "",
      "ptcTrustRootGovernContract": "did:bid:ef93ANo97CLU9kMm6KQxX9sU5Gdvcbjr",
      "tpBtaGovernContract": ""
    }
  }
```

ä¸‹é¢å¯¹å„ä¸ªé…ç½®é¡¹ç»™å‡ºè§£é‡Šï¼š

é¦–å…ˆæ˜¯é¢è¯æœåŠ¡çš„é…ç½®ï¼š

- authorizedKeyPemï¼šæœ‰æƒé™ç”³è¯·è·¨é“¾èº«ä»½ï¼ˆRelayerã€PTCï¼‰çš„ç§é’¥ï¼Œå¡«å…¥PEMæ ¼å¼çš„PKCS#8çš„ç§é’¥ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨CLIåˆšåˆšç”Ÿæˆçš„ç§é’¥private_key.pemã€‚

  > [!TIP]
  > å¯ä»¥è¿™æ ·å°†ç§é’¥æ‰“å°ä¸ºä¸€è¡Œï¼šcat private_key.pem | tr '\n' '|' | sed 's/|/\\n/g'

- authorizedPublicKeyPemï¼š`authorizedKeyPem`å¯¹åº”çš„å…¬é’¥ï¼Œå¡«å…¥PEMæ ¼å¼çš„PKCS#8çš„å…¬é’¥ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨CLIåˆšåˆšç”Ÿæˆçš„å…¬é’¥public_key.pemã€‚

- authorizedSigAlgoï¼š`authorizedKeyPem`ç§é’¥çš„ç­¾åç®—æ³•ï¼Œç›®å‰æ”¯æŒKeccak256WithSecp256k1ã€Ed25519ã€SM3withSM2ã€SHA256withECDSAã€SHA256withRSAäº”ç§ç®—æ³•ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨åˆšåˆšç”Ÿæˆç§é’¥çš„ç®—æ³•ï¼šKeccak256WithSecp256k1ï¼›

- clientCrossChainCertPemï¼šPTCçš„è·¨é“¾è¯ä¹¦ï¼Œéœ€è¦æå‰ä»BCDNSå¤„è·å–ï¼Œè¿™é‡Œä½¿ç”¨åˆšæ‰ä»BIF BCDNSè·å–åˆ°çš„PTCè¯ä¹¦ã€‚

- clientPrivateKeyPemï¼šRelayerè·¨é“¾è¯ä¹¦æŒæœ‰è€…çš„ç§é’¥ï¼Œå¡«å…¥PEMæ ¼å¼çš„PKCS#8çš„ç§é’¥ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨CLIåˆšåˆšç”Ÿæˆçš„ç§é’¥private_key.pemã€‚

- sigAlgoï¼š`clientPrivateKeyPem`ç§é’¥çš„ç­¾åç®—æ³•ï¼Œç›®å‰æ”¯æŒKeccak256WithSecp256k1ã€Ed25519ã€SM3withSM2ã€SHA256withECDSAã€SHA256withRSAäº”ç§ç®—æ³•ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨åˆšåˆšç”Ÿæˆç§é’¥çš„ç®—æ³•ï¼šKeccak256WithSecp256k1ï¼›

- urlï¼šé¢è¯æœåŠ¡çš„URLã€‚

ç„¶åæ˜¯[æ˜Ÿç«é“¾ç½‘](https://bif-doc.readthedocs.io/zh-cn/2.0.0/quickstart/å¿«é€Ÿæ¥å…¥æ˜Ÿç«é“¾.html)çš„é…ç½®ï¼Œç”±äºSupervisorä¸éœ€è¦ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä¾‹å­æ²¡æœ‰åŒ…å«éƒ¨åˆ†é…ç½®ï¼š

- bifAddressï¼šæ˜Ÿç«é“¾ç½‘çš„è´¦æˆ·åœ°å€ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨Relayerçš„å…¬é’¥æ¥ç”Ÿæˆè¯¥åœ°å€ï¼Œå¯ä»¥å‚è€ƒ[ä»£ç ](https://github.com/AntChainOpenLabs/AntChainBridgeRelayer/blob/develop/r-cli/src/main/java/com/alipay/antchain/bridge/relayer/cli/command/UtilsCommands.java#L196)ã€‚Supervisorä¸éœ€è¦ã€‚
- bifChainRpcUrlï¼šæ˜Ÿç«é“¾ç½‘èŠ‚ç‚¹çš„RPCåœ°å€ã€‚Supervisoréœ€è¦ï¼âš ï¸
- bifPrivateKeyï¼šæ˜Ÿç«é“¾ç½‘è´¦æˆ·çš„ç§é’¥ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨Relayerçš„ç§é’¥`clientPrivateKeyPem`æ¥ç”Ÿæˆè¯¥åœ°å€ï¼Œå¯ä»¥å‚è€ƒ[ä»£ç ](https://github.com/AntChainOpenLabs/AntChainBridgeRelayer/blob/6658dfa599b73b1aa4f3cf156e1fc1d72c5cb7c6/r-cli/src/main/java/com/alipay/antchain/bridge/relayer/cli/command/UtilsCommands.java#L203C20-L203C42)ã€‚Supervisorä¸éœ€è¦ã€‚
- certificatesGovernContractï¼šè·¨é“¾è¯ä¹¦ç®¡ç†åˆçº¦ï¼Œéƒ¨ç½²åœ¨æ˜Ÿç«é“¾ç½‘ä¹‹ä¸Šï¼Œè¿™äº›åˆçº¦åº”è¯¥ä»BIF BCDNSè¿ç»´äººå‘˜å¤„è·å–ï¼ğŸ“¢Supervisorä¸éœ€è¦ã€‚
- domainGovernContractï¼šåŸŸåç®¡ç†åˆçº¦ï¼Œå‚è€ƒ[æ˜Ÿç«é“¾ç½‘BCDNS](https://github.com/caict-4iot-dev/BCDNS)ï¼Œä¾èµ–çš„æ˜Ÿç«é“¾ç½‘BCDNSåº”å½“æœ‰å”¯ä¸€ä¸€æœ¬åŸŸåç®¡ç†åˆçº¦ã€‚Supervisorä¸éœ€è¦ã€‚
- ptcGovernContractï¼šPTCèº«ä»½ç®¡ç†åˆçº¦ï¼Œä¾èµ–çš„æ˜Ÿç«é“¾ç½‘BCDNSåº”å½“æœ‰å”¯ä¸€ä¸€æœ¬PTCèº«ä»½ç®¡ç†åˆçº¦ã€‚Supervisorä¸éœ€è¦ã€‚
- relayerGovernContractï¼šRelayerèº«ä»½ç®¡ç†åˆçº¦ï¼Œä¾èµ–çš„æ˜Ÿç«é“¾ç½‘BCDNSåº”å½“æœ‰å”¯ä¸€ä¸€æœ¬Relayerèº«ä»½ç®¡ç†åˆçº¦ã€‚Supervisorä¸éœ€è¦ã€‚
- ptcTrustRootGovernContractï¼šPTCä¿¡ä»»æ ¹ç®¡ç†åˆçº¦ï¼Œ*ä¸‹é¢å°†ä½¿ç”¨Supervisorå‘BCDNSæ³¨å†Œä¿¡ä»»æ ¹*ğŸ’ªã€‚
- tpBtaGovernContractï¼šTpBTAç®¡ç†åˆçº¦ï¼ŒTpBTAæ˜¯PTCå¯¹äºç‰¹å®šè·¨é“¾é€šé“çš„èƒŒä¹¦éªŒè¯æ ¹ï¼ŒåŒ…å«å…·ä½“èƒŒä¹¦å…¬é’¥ä¿¡æ¯å’ŒéªŒè¯è§„åˆ™ã€‚Supervisorä¸éœ€è¦ã€‚

å‡†å¤‡å®Œæ¯•åï¼Œä¿å­˜åˆ°æ–‡ä»¶ï¼Œæ¯”å¦‚bcdns.jsonå¤‡ç”¨ã€‚

åœ¨Supervisor CLIè¿è¡Œï¼Œå¯åŠ¨BIF BCDNSå®¢æˆ·ç«¯ã€‚

```
start-bcdns-client --bcdnsType BIF --bcdnsClientConfigPath ./bcdns.json
```



**ç¬¬äº”æ­¥**ï¼Œæ„é€ PTC Trust Rootï¼Œå¹¶æ³¨å†Œåˆ°BCDNSã€‚

å‡è®¾å‡†å¤‡éƒ¨ç½²å››ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆç¬¬ä¸€ã€äºŒæ­¥åº”è¯¥åˆå§‹åŒ–äº†å››ä»½å¯†é’¥ã€‚

å‡†å¤‡å››ä»½æ³¨å†Œæ–‡ä»¶ï¼Œæ¯”å¦‚ä¸‹é¢ä¸€ä»½ã€‚endpoint_urlæ˜¯ä¸€å·Committee Nodeçš„æœåŠ¡ç«¯URLï¼Œè¿™é‡Œé»˜è®¤ä½¿ç”¨grpc over tlsï¼›keysæ”¾å…¥ä¸€å·èŠ‚ç‚¹ç­¾åå¯¹åº”çš„å…¬é’¥ï¼Œdefaultä¸ºå…¬é’¥çš„åå­—ï¼Œè¿™é‡Œä¼šå’ŒCommittee Nodeè‡ªå·±çš„é…ç½®å¯¹åº”ï¼Œæ‰€ä»¥ä¸è¦ä¹±å¡«ğŸ™…ï¼›node_idæ˜¯è¯¥èŠ‚ç‚¹åœ¨å§”å‘˜ä¼šçš„IDï¼Œè¿™é‡Œä¼šå’ŒCommittee Nodeè‡ªå·±çš„é…ç½®å¯¹åº”ï¼Œæ‰€ä»¥ä¸è¦ä¹±å¡«ğŸ™…ï¼›tls_certæ˜¯ç¬¬ä¸€æ­¥ç”Ÿæˆçš„TLSè¯ä¹¦ï¼Œå¡«å…¥å³å¯ã€‚å°†å‡†å¤‡å¥½çš„ä¸€å·èŠ‚ç‚¹é…ç½®æ–‡ä»¶å­˜ä¸ºâ€œnode1.jsonâ€ã€‚

```
{
    "endpoint_url": "grpcs://172.16.0.1:10080",
    "keys": {
      "default": "-----BEGIN PUBLIC KEY-----\nMFYwEAYHKoZIzj0CAQYFK4EEAAoDQgAEdCE/9G1o0QT7fhB8fa/6UIuAMBCfACna\nNHDS+nD3jvqKHI1d2H1d4+pFzYLMqqMDyZdPy0FYbXcc16BrLWB/sQ==\n-----END PUBLIC KEY-----\n"
    },
    "node_id": "node1",
    "tls_cert": "-----BEGIN CERTIFICATE-----\nMIIDoTC...6o9JYouD2E\n-----END CERTIFICATE-----\n"
  }
```

ä¾æ¬¡å‡†å¤‡å¥½node1.jsonã€node2.jsonã€node3.jsonã€node4.jsonã€‚

ç„¶åå¯åŠ¨Supervisor CLIï¼Œè¿è¡Œä¸‹é¢ğŸ‘‡å‘½ä»¤ï¼Œæ³¨æ„committeeNodeIdså¯¹åº”é…ç½®æ–‡ä»¶çš„åå­—ï¼ŒcommitteeNodesInfoDirä¸ºå­˜æ”¾è¿™äº›é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™é‡Œè¦æ±‚node1.jsonã€node2.jsonã€node3.jsonã€node4.jsonéƒ½æ”¾åœ¨è¿™é‡Œè·¯å¾„ä¸‹ï¼Œè¿è¡Œåå¾—åˆ°ä¸€ä¸ªBase64ï¼š

```
generate-ptc-trust-root --committeeNodeIds node1,node2,node3,node4 --committeeNodesInfoDir /path/to/config-files
```

æ‹·è´è¿™ä¸ªBase64ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤ï¼Œå°†Base64ä½œä¸ºptcTrustRootStrçš„å‚æ•°ç²˜è´´ä¸Šå»ï¼Œç„¶åè¿è¡Œå³å¯ï¼Œè¿™é‡Œä¼šå‘BIF BCDNSå‘è¯·æ±‚æ³¨å†Œï¼š

```
add-ptc-trust-root --ptcTrustRootStr Qkw2ZHIyM...yUWplbE
```



**ç¬¬å…­æ­¥**ï¼Œå‡†å¤‡Committee Nodeçš„é…ç½®æ–‡ä»¶`config/application.yml`ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢æ˜¯åˆå§‹åŒ–çš„é…ç½®æ–‡ä»¶ï¼ŒæŒ‰éœ€è¦ä¿®æ”¹ä¸‹é¢é…ç½®ï¼Œå…¶ä»–é»˜è®¤å³å¯ï¼š

- spring.datasourceï¼šé¦–å…ˆé…ç½®å¥½æ•°æ®åº“çš„urlã€å¯†ç ç­‰ï¼Œæ”¯æŒJasyptåŠ å¯†ï¼Œä¸‹æ–‡ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨ï¼›
- committee.node.idï¼šå½“å‰è¿è¡ŒèŠ‚ç‚¹çš„IDï¼Œè‡ªå®šä¹‰å³å¯ï¼Œæ¯”å¦‚node1ã€node2ç­‰ï¼Œä¸å¯ä»¥å’Œå…¶ä»–èŠ‚ç‚¹ç›¸åŒï¼›
- committee.node.credential.private-key-fileï¼šNodeç­¾åçš„ç§é’¥ï¼›
- committee.node.credential.cert-fileï¼šPTCè¯ä¹¦ï¼Œè¿™éœ€è¦supervisorå…ˆå®Œæˆå‘BCDNSçš„ç”³è¯·è¯ä¹¦çš„æ“ä½œï¼›
- committee.plugin.repoï¼šHCDVSæ’ä»¶çš„å®‰è£…ç›®å½•ï¼›

> [!WARNING]  
> å¦‚æœä½ æƒ³åœ¨åŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨å¤šä¸ªcommittee nodeæœåŠ¡ï¼Œè®°å¾—ä¿®æ”¹ä¸¤ä¸ªç«¯å£çš„é…ç½®ï¼š
> é¦–å…ˆæ˜¯committee.node.admin.portï¼Œä»¥åŠgrpc.server.portï¼Œå¦åˆ™å¯åŠ¨æ—¶ä¼šæœ‰ç«¯å£å†²çªå¯¼è‡´å¯åŠ¨å¤±è´¥

```yaml
spring:
  application:
    name: committee-ptc
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/committee_node?serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true
    password: YOUR_PWD
    username: root
logging:
  file:
    path: ./logs
  level:
    app: INFO
# setting for committee
committee:
  id: default
  node:
    id: node1
    credential:
      sign-algo: "Keccak256WithSecp256k1"
      private-key-file: "file:private_key.pem"
      cert-file: "file:ptc.crt"
  plugin:
    # where to load the hetero-chain plugins
    repo: ./plugins
    policy:
      # limit actions of the plugin classloader
      classloader:
        resource:
          ban-with-prefix:
            # the plugin classloader will not read the resource file starting with the prefix below
            APPLICATION: "META-INF/services/io.grpc."
grpc:
  server:
    port: 10080
    security:
      # enable tls mode
      enabled: true
      # server certificate
      certificate-chain: file:tls_certs/server.crt
      # server key
      private-key: file:tls_certs/server.key
      # Mutual Certificate Authentication
      trustCertCollection: file:tls_certs/trust.crt
      # clientAuth: REQUIRE
```



**ç¬¬ä¸ƒæ­¥**ï¼Œå®‰è£…HCDVSæ’ä»¶ã€‚

å°†éœ€è¦æ”¯æŒçš„é“¾çš„æ’ä»¶æ”¾åˆ°Nodeå®‰è£…è·¯å¾„çš„./pluginsä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯é…ç½®é¡¹`committee.plugin.repoæŒ‡å®šçš„ç›®å½•ã€‚æ¯”å¦‚è¿™é‡Œå®‰è£…äº†èš‚èšé“¾å’Œæ˜Ÿç«é“¾ç½‘çš„éªŒè¯æ’ä»¶ï¼š

```
tree plugins/
plugins/
|-- bif-bbc-plugin-0.1-SNAPSHOT-plugin.jar
`-- mychain010-bbc-1.0.0-SNAPSHOT-plugin.jar

0 directories, 2 files
```



**ç¬¬å…«æ­¥**ï¼Œå¯åŠ¨NodeæœåŠ¡

åœ¨Nodeå®‰è£…ç›®å½•çš„configç›®å½•ä¸‹ï¼Œæ‰¾åˆ°ddl.sqlï¼Œä¸ºNodeåˆå§‹åŒ–æ•°æ®åº“ã€‚

ç„¶åè¿è¡Œä¸‹é¢å‘½ä»¤å¯åŠ¨èŠ‚ç‚¹ï¼š

```
bin/start.sh 
```

å¯ä»¥é€šè¿‡æŸ¥çœ‹æ—¥å¿—çš„æ–¹å¼æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¯åŠ¨ï¼Œæ—¥å¿—è·¯å¾„åœ¨å®‰è£…ç›®å½•çš„ï¼šlog/committee-nodeï¼Œapplication.logè®°å½•äº†é™¤ERRORä»¥å¤–æ—¥å¿—ï¼Œerror.logè®°å½•ERRORæ—¥å¿—ã€‚



**ç¬¬ä¹æ­¥**å¯åŠ¨æœåŠ¡ï¼Œåœ¨CLIæ‰§è¡Œåˆå§‹åŒ–çš„å‘½ä»¤ã€‚

å¯åŠ¨Node CLIï¼Œè¿è¡Œä¸‹é¢å‘½ä»¤ï¼Œä½¿ç”¨ä¸ºä¸Šé¢Supervisor CLIå‡†å¤‡çš„BCDNSé…ç½®æ–‡ä»¶ï¼Œåœ¨èŠ‚ç‚¹æ³¨å†ŒBIF BCDNSï¼š

```
register-bcdnsservice --bcdnsType bif --propFile /path/to/supervisor-cli/bcdns.json
```

ä¹‹åå¯ä»¥é€šè¿‡è¿è¡Œget-bcdnsserviceæŸ¥çœ‹å·²æ³¨å†Œçš„BCDNSã€‚

## ğŸ”§å…¶ä»–

Committee Nodeæ”¯æŒä½¿ç”¨[Jasypt](https://github.com/ulisesbocchio/jasypt-spring-boot)åŠ å¯†é…ç½®ã€‚

- æ‰¾åˆ°ä½ çš„é…ç½®æ–‡ä»¶`/path/to/your/application.yml`ï¼Œå°†æ‰€æœ‰ä½ æƒ³è¦åŠ å¯†çš„é…ç½®æ”¹æˆ`DEC(...)`æ ¼å¼çš„æ–‡æœ¬ã€‚

  ```
    datasource:
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://localhost:3306/committee_node1?serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true
      #æ¯”å¦‚è¿™é‡Œ
      password: DEC(password)
      username: root
  ```

- è¿›å…¥é¡¹ç›®çš„r-bootstrapç›®å½•ï¼Œä½¿ç”¨maven[æ’ä»¶](https://github.com/ulisesbocchio/jasypt-spring-boot?tab=readme-ov-file#encryption)å¯¹é…ç½®æ–‡ä»¶è¿›è¡ŒåŠ å¯†ã€‚

  ```
  mvn jasypt:encrypt -Djasypt.plugin.path="file:/path/to/your/application.yml" -Djasypt.encryptor.password=the_password
  ```

  **å¿½ç•¥æ‰§è¡Œæ—¶çš„`ClassNotFoundException`ã€‚*

- å°†å¾—åˆ°ä¸‹é¢é…ç½®æ–‡ä»¶ï¼š

  ```
    datasource:
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://localhost:3306/relayer?serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true
      #æ¯”å¦‚è¿™é‡Œ
      password: ENC(DLDD9/HtY1mBx3ez1f6k9iCTt8VFANfx7n3g7gtweJ1DNI5GgdNUu8SUXYegWLbB)
      username: root
  ```

- ä½¿ç”¨åŠ å¯†ä¹‹åçš„é…ç½®æ–‡ä»¶å¯åŠ¨æœåŠ¡ï¼Œè¿è¡Œï¼š

  ```
  bin/start.sh -P the_password
  ```



## ğŸ¤ç¤¾åŒºæ²»ç†

AntChain Bridge æ¬¢è¿æ‚¨ä»¥ä»»ä½•å½¢å¼å‚ä¸ç¤¾åŒºå»ºè®¾ã€‚

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å‚ä¸ç¤¾åŒºè®¨è®º

- é’‰é’‰

![scan dingding](https://antchainbridge.oss-cn-shanghai.aliyuncs.com/antchainbridge/document/picture/dingding2024.png?x-oss-process=image/resize,w_400/quality,Q_100)

- é‚®ä»¶

å‘é€é‚®ä»¶åˆ°`antchainbridge@service.alipay.com`

## ğŸ“„License

è¯¦æƒ…å‚è€ƒ[LICENSE](./LICENSE)ã€‚

